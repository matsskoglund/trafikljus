<html>
<head>
</head>
<script src="http://koda.nu/simple.js">

  /*
    Uppgift: Trafikljus!
    
    Det finns bilder för grön och röd gubbe:
    
    http://koda.nu/bilder/iis/trafikljus/walk_green.png
    http://koda.nu/bilder/iis/trafikljus/walk_red.png
    
    samt bilder för grönt, gult och rött ljus:
    
    http://koda.nu/bilder/iis/trafikljus/light_green.png
    http://koda.nu/bilder/iis/trafikljus/light_yellow.png
    http://koda.nu/bilder/iis/trafikljus/light_red.png
    
    Uppgift 1:
    
    Hur kan du modifiera koden nedan så att det blir grönt
    för gångare när man trycker på en knapp, och då rött för
    bilar? 

    Du kommer behöva lägga in if-satser som håller koll på 
    olika knappar på tangentbordet.
    
    Uppgift 2:
    
    Lägg till en timer som ser till så att det är
    grönt för gångarna under en viss tid, och sen kopplar det
    över till bilarna automatiskt.
    
    Uppgift 3:
    
    När man trycker på knappen för att gå över vägen så ska det inte
    bli grönt för fotgängare direkt. Först efter 5 sekunder ska det bli
    gult för bilarna. Sen efter ytterligare 5 sekunder ska det bli rött
    för bilarna och grönt för fotgängare. Fotgängarna ska få ha grönt
    i 5 sekunder, och sedan ska de få rött. Efter att de haft rött i 2 sekunder
    så ska bilarna få grönt.
    
  */
    
  var a = 60;
  var timer = 0;
  var timerStarted = false;
  const FIRST_LANE_POS = 200
  const LANE_WIDTH = 136
  const FIRST_WALKING_LANE_POS = 500
  const WALKING_LANE_WIDTH = 136

  const DEBUG = true
  const TRAFFIC_START_POS = 250
  const TRAFFIC_END_POS = 1110
  var ticker = TRAFFIC_START_POS
  var carDistanceTimer = 100
  var generateCars = 40
  if(DEBUG)
    text (100, 200, 20, timer, "red")
  
  var cars = new Array()
  var lanes = new Array(5)
  function update()
  {
    // Generate cars 
    if((generateCars >= 40) && (trafficRunning(timer))){
      for(laneIdx=0; laneIdx <= 4; laneIdx++){     
        newCar = {
          color:getRandomColor(), 
          lane:laneIdx, 
          pos:TRAFFIC_START_POS  
        }; 
        cars.push(newCar)
        generateCars = 0
      }
    }else if (trafficRunning(timer)){
      generateCars++
    }
    picture(0,0, "http://koda.nu/bilder/iis/trafikljus/street.png", totalWidth, totalHeight);
    text (100, 200, 20, timer, "red")
    for(i = 0; i < cars.length; i++){
      if(trafficRunning(timer) || (!trafficRunning(timer) && (cars[i].pos < 370))|| (cars[i].pos > 370)){
        cars[i].pos += 3
      }
      drawSingelCar(cars[i])

      // Remove car and create new one
      if(cars[i].pos >= TRAFFIC_END_POS){
        cars.splice(i, 1)
        
      }
    }
    drawMan(100,0,"red")

    if(DEBUG)
      text (200, 200, 20, cars[0].pos, "red")

    // Press walk button
    if (keyboard.space)
    {
      timerStarted = true;
    }
      
    if (timerStarted == true)
    {
      timer += 1;
    }

    walkSign = getWalkSign(timer) 
    trafficSign = getTrafficSign(timer)
    picture(totalWidth-70,0,trafficSign)
    picture(0,0,walkSign)

    if (timer == 400)
    {
      timerStarted = false;
      timer = 0
    }
  }

function getRandomColor() {
  var letters = '0123456789ABCDEF';
  var color = '#';
  for (var i = 0; i < 6; i++) {
    color += letters[Math.floor(Math.random() * 16)];
  }
  return color;
}
 function trafficRunning(timer)
 {
  
    if(timer < 60){
      
      return true
    }else{
      
      return false
    }
 }

 function walkerWalking(timer)
 {
  if(timer >= 160 && timer < 320)
      return true
    else
      return false
 }
  function getTrafficSign(timer)
  {

    // Show yellow sign after a short while from button has been pressed and show it for 
    if ((timer > 60 && timer < 120) || (timer >= 360))
    {
        return "http://koda.nu/bilder/iis/trafikljus/light_yellow.png"
    } 

    // Show red sign after yellow sign and show it for 
    if (timer >= 120 && timer < 360)
    {
        return "http://koda.nu/bilder/iis/trafikljus/light_red.png"
    }
    return "http://koda.nu/bilder/iis/trafikljus/light_green.png"
  }

  function getWalkSign(timer)
  {
    if (timer >= 160 && timer < 320)
    {
      return "http://koda.nu/bilder/iis/trafikljus/walk_green.png"
    }else 
      return "http://koda.nu/bilder/iis/trafikljus/walk_red.png"
  }
  function getLanePos(laneNo)
  {
    switch (laneNo) {
      case 0:
        return FIRST_LANE_POS
        break;
      case 1:
        return FIRST_LANE_POS+LANE_WIDTH
        break;  
      case 2:
        return FIRST_LANE_POS+LANE_WIDTH*2
        break;  
      case 3:
        return FIRST_LANE_POS+LANE_WIDTH*3
        break;  
      case 4:
        return FIRST_LANE_POS+LANE_WIDTH*4
        break;  
      default:
        return -1
        break;
    }
  }
  function getWalkingLanePos(laneNo)
  {
    switch (laneNo) {
      case 0:
        return FIRST_WALKING_LANE_POS
        break;
      case 1:
        return FIRST_WALKING_LANE_POS+WALKING_LANE_WIDTH
        break;  
      case 2:
        return FIRST_WALKING_LANE_POS+WALKING_LANE_WIDTH*2
        break;  
      case 3:
        return FIRST_WALKING_LANE_POS+WALKING_LANE_WIDTH*3
        break;  
      case 4:
        return FIRST_WALKING_LANE_POS+WALKING_LANE_WIDTH*4
        break;  
      default:
        return -1
        break;
    }
  }
  function drawSingelCar(car)
  {
    lanePos = getLanePos(car.lane)
    rectangle(car.pos,lanePos+20,80,60,car.color)
    rectangle(car.pos+50,lanePos+30,30,30,"lightblue")
    circle(car.pos+20,lanePos+80,13,"black")
    circle(car.pos+60,lanePos+80,13,"black")
  }
  function drawMan(pos,lane,color)
  {
    lanePos = getWalkingLanePos(lane)
    rectangle(lanePos+53,pos+5,50,28,"red")
    rectangle(lanePos+48,pos+8,62,20,"red")
    circle(lanePos+78,pos+20,20,"black")
    circle(lanePos+78,pos+20,10,"gray")
    
  }

  function drawbike(pos,color)
  {
    rectangle(pos,45,80,40,color)
    rectangle(pos+48,25,30,30,"lightblue")
    circle(pos+20,80,13,"black")
    circle(pos+60,80,13,"black")
  }
</script>


<body>
</body>
</html>