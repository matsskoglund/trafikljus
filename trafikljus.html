<html>
<head>
</head>
<script src="http://koda.nu/simple.js">

  /*
    Uppgift: Trafikljus!
    
    Det finns bilder för grön och röd gubbe:
    
    http://koda.nu/bilder/iis/trafikljus/walk_green.png
    http://koda.nu/bilder/iis/trafikljus/walk_red.png
    
    samt bilder för grönt, gult och rött ljus:
    
    http://koda.nu/bilder/iis/trafikljus/light_green.png
    http://koda.nu/bilder/iis/trafikljus/light_yellow.png
    http://koda.nu/bilder/iis/trafikljus/light_red.png
    
    Uppgift 1:
    
    Hur kan du modifiera koden nedan så att det blir grönt
    för gångare när man trycker på en knapp, och då rött för
    bilar? 

    Du kommer behöva lägga in if-satser som håller koll på 
    olika knappar på tangentbordet.
    
    Uppgift 2:
    
    Lägg till en timer som ser till så att det är
    grönt för gångarna under en viss tid, och sen kopplar det
    över till bilarna automatiskt.
    
    Uppgift 3:
    
    När man trycker på knappen för att gå över vägen så ska det inte
    bli grönt för fotgängare direkt. Först efter 5 sekunder ska det bli
    gult för bilarna. Sen efter ytterligare 5 sekunder ska det bli rött
    för bilarna och grönt för fotgängare. Fotgängarna ska få ha grönt
    i 5 sekunder, och sedan ska de få rött. Efter att de haft rött i 2 sekunder
    så ska bilarna få grönt.
    
  */
    
  var a = 60;
  var timer = 0;
  var timerStarted = false;
  const FIRST_LANE_POS = 200
  const LANE_WIDTH = 136
  const DEBUG = true
  const TRAFFIC_START_POS = 250
  const TRAFFIC_END_POS = 1110
  var ticker = TRAFFIC_START_POS

  if(DEBUG)
    text (100, 200, 20, timer, "red")
   
  function update()
  {
    // Start
    picture(0,0, "http://koda.nu/bilder/iis/trafikljus/street.png", totalWidth, totalHeight);
    picture(totalWidth-70,0, "http://koda.nu/bilder/iis/trafikljus/light_green.png");
    picture(0,0, "http://koda.nu/bilder/iis/trafikljus/walk_red.png"); 
    text (100, 200, 20, timer, "red")
    
    if(ticker < TRAFFIC_END_POS)
      ticker += 3
    else 
      ticker = TRAFFIC_START_POS

    if(DEBUG)
      text (200, 200, 20, ticker, "red")

    // Press walk button
    if (keyboard.space)
    {
      timerStarted = true;
    }
      
    if (timerStarted == true)
    {
      timer += 1;
    }

    walkSign = getWalkSign(timer) 
    trafficSign = getTrafficSign(timer)
    picture(totalWidth-70,0,trafficSign)
    picture(0,0,walkSign)
    
    
    
      drawcar(ticker,0,"red")
      drawcar(ticker,1,"green")
      drawcar(ticker,2,"blue")
      drawcar(ticker,3,"yellow")
      drawcar(ticker,4,"orange")
      if (timer == 400)
      {
        timerStarted = false;
        timer = 0
      }
  }

  function getTrafficSign(timer)
  {

    // Show yellow sign after a short while from button has been pressed and show it for 
    if ((timer > 60 && timer < 120) || (timer >= 360))
    {
        return "http://koda.nu/bilder/iis/trafikljus/light_yellow.png"
    } 
    // Show red sign after yellow sign and show it for 
    if (timer >= 120 && timer < 360)
    {
        return "http://koda.nu/bilder/iis/trafikljus/light_red.png"
    }
    return "http://koda.nu/bilder/iis/trafikljus/light_green.png"
  }

  function getWalkSign(timer)
  {
    if (timer >= 160 && timer < 320)
    {
      return "http://koda.nu/bilder/iis/trafikljus/walk_green.png"
    }else 
      return "http://koda.nu/bilder/iis/trafikljus/walk_red.png"
  }
  function getLanePos(laneNo)
  {
    switch (laneNo) {
      case 0:
        return FIRST_LANE_POS
        break;
      case 1:
        return FIRST_LANE_POS+LANE_WIDTH
        break;  
      case 2:
        return FIRST_LANE_POS+LANE_WIDTH*2
        break;  
      case 3:
        return FIRST_LANE_POS+LANE_WIDTH*3
        break;  
      case 4:
        return FIRST_LANE_POS+LANE_WIDTH*4
        break;  
      default:
        return -1
        break;
    }
  }
  function drawcar(pos,lane,color)
  {
    lanePos = getLanePos(lane)
    rectangle(pos,lanePos+20,80,60,color)
    rectangle(pos+50,lanePos+30,30,30,"lightblue")
    circle(pos+20,lanePos+80,13,"black")
    circle(pos+60,lanePos+80,13,"black")
  }

  function drawbike(pos,color)
  {
    rectangle(pos,45,80,40,color)
    rectangle(pos+48,25,30,30,"lightblue")
    circle(pos+20,80,13,"black")
    circle(pos+60,80,13,"black")
  }
</script>


<body>
</body>
</html>